import{g as X,u as Z,h as M,i as ee,j as se,t as te,k as le,l as q,m as H,n as t,p as ae,w as j,q as ie,R as _,v as re,x as ue,y as ne,z as oe,A as ce,B as b,C as T,D as ve,E as he,F as me,G as de,H as pe,I as ye,J as Ee,K as U,L as ge,M as C}from"./app-C0BZ2Kof.js";const Ae=["/","/posts/encryption-tool.html","/posts/file-diff-tool.html","/posts/interval_training_tool.html","/posts/pdf-check.html","/posts/stopwatch_timer.html","/posts/string_obfuscator.html","/posts/text_statistics_tool.html","/404.html","/posts/","/category/","/category/%E5%B7%A5%E5%85%B7/","/tag/","/tag/%E5%AD%97%E7%AC%A6%E5%8A%A0%E8%A7%A3%E5%AF%86/","/tag/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/","/tag/%E6%96%87%E4%BB%B6%E5%AF%B9%E6%AF%94/","/tag/%E9%9F%B3%E7%A8%8B%E8%AE%AD%E7%BB%83%E5%B7%A5%E5%85%B7/","/tag/%E9%9F%B3%E4%B9%90/","/tag/pdf%E7%AD%BE%E5%90%8D%E6%A3%80%E6%9F%A5/","/tag/%E8%AE%A1%E6%97%B6%E5%99%A8%E5%B7%A5%E5%85%B7/","/tag/%E5%AD%97%E7%AC%A6%E6%B7%B7%E6%B7%86%E5%B7%A5%E5%85%B7/","/tag/%E5%86%99%E4%BD%9C%E5%B7%A5%E5%85%B7/","/tag/%E5%AD%97%E7%AC%A6%E7%BB%9F%E8%AE%A1%E5%B7%A5%E5%85%B7/","/article/","/star/","/timeline/"],Be="SLIMSEARCH_QUERY_HISTORY",y=U(Be,[]),fe=()=>{const{queryHistoryCount:a}=C;return{enabled:a>0,queryHistories:y,addQueryHistory:u=>{y.value=Array.from(new Set([u,...y.value.slice(0,a-1)]))},removeQueryHistory:u=>{y.value=[...y.value.slice(0,u),...y.value.slice(u+1)]}}},F=a=>Ae[a.id]+("anchor"in a?`#${a.anchor}`:""),He="SLIMSEARCH_RESULT_HISTORY",{resultHistoryCount:I}=C,E=U(He,[]),Ce=()=>({enabled:I>0,resultHistories:E,addResultHistory:r=>{{const u={link:F(r),display:r.display};"header"in r&&(u.header=r.header),E.value=[u,...E.value.slice(0,I-1)]}},removeResultHistory:r=>{E.value=[...E.value.slice(0,r),...E.value.slice(r+1)]}}),ke=a=>{const r=ve(),u=M(),k=he(),n=q(0),g=H(()=>n.value>0),v=me([]);return de(()=>{const{search:R,terminate:m}=pe(),A=ye(d=>{const{resultsFilter:w=l=>l,querySplitter:p,suggestionsFilter:S,...i}=r.value;d?(n.value+=1,R(d,u.value,i).then(l=>w(l,d,u.value,k.value)).then(l=>{n.value-=1,v.value=l}).catch(l=>{console.warn(l),n.value-=1,n.value||(v.value=[])})):v.value=[]},C.searchDelay-C.suggestDelay,{maxWait:5e3});j([a,u],([d])=>{A(d.join(" "))},{immediate:!0}),Ee(()=>{m()})}),{isSearching:g,results:v}};var we=X({name:"SearchResult",props:{queries:{type:Array,required:!0},isFocusing:Boolean},emits:["close","updateQuery"],setup(a,{emit:r}){const u=Z(),k=M(),n=ee(se),{addQueryHistory:g,queryHistories:v,removeQueryHistory:R}=fe(),{resultHistories:m,addResultHistory:A,removeResultHistory:d}=Ce(),w=te(a,"queries"),{results:p,isSearching:S}=ke(w),i=le({isQuery:!0,index:0}),l=q(0),h=q(0),L=H(()=>v.value.length>0||m.value.length>0),x=H(()=>p.value.length>0),D=H(()=>p.value[l.value]||null),O=()=>{const{isQuery:e,index:s}=i;s===0?(i.isQuery=!e,i.index=e?m.value.length-1:v.value.length-1):i.index=s-1},P=()=>{const{isQuery:e,index:s}=i;s===(e?v.value.length-1:m.value.length-1)?(i.isQuery=!e,i.index=0):i.index=s+1},Y=()=>{l.value=l.value>0?l.value-1:p.value.length-1,h.value=D.value.contents.length-1},z=()=>{l.value=l.value<p.value.length-1?l.value+1:0,h.value=0},G=()=>{h.value<D.value.contents.length-1?h.value+=1:z()},J=()=>{h.value>0?h.value-=1:Y()},Q=e=>e.map(s=>ge(s)?s:t(s[0],s[1])),K=e=>{if(e.type==="customField"){const s=oe[e.index]||"$content",[o,f=""]=ce(s)?s[k.value].split("$content"):s.split("$content");return e.display.map(c=>t("div",Q([o,...c,f])))}return e.display.map(s=>t("div",Q(s)))},B=()=>{l.value=0,h.value=0,r("updateQuery",""),r("close")},V=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},n.value.queryHistory),v.value.map((e,s)=>t("div",{class:["slimsearch-result-item",{active:i.isQuery&&i.index===s}],onClick:()=>{r("updateQuery",e)}},[t(b,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},e),t("button",{class:"slimsearch-remove-icon",innerHTML:T,onClick:o=>{o.preventDefault(),o.stopPropagation(),R(s)}})]))])),W=()=>t("ul",{class:"slimsearch-result-list"},t("li",{class:"slimsearch-result-list-item"},[t("div",{class:"slimsearch-result-title"},n.value.resultHistory),m.value.map((e,s)=>t(_,{to:e.link,class:["slimsearch-result-item",{active:!i.isQuery&&i.index===s}],onClick:()=>{B()}},()=>[t(b,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[e.header?t("div",{class:"content-header"},e.header):null,t("div",e.display.map(o=>Q(o)).flat())]),t("button",{class:"slimsearch-remove-icon",innerHTML:T,onClick:o=>{o.preventDefault(),o.stopPropagation(),d(s)}})]))]));return ae("keydown",e=>{if(a.isFocusing){if(x.value){if(e.key==="ArrowUp")J();else if(e.key==="ArrowDown")G();else if(e.key==="Enter"){const s=D.value.contents[h.value];g(a.queries.join(" ")),A(s),u.push(F(s)),B()}}else if(e.key==="ArrowUp")O();else if(e.key==="ArrowDown")P();else if(e.key==="Enter"){const{index:s}=i;i.isQuery?(r("updateQuery",v.value[s]),e.preventDefault()):(u.push(m.value[s].link),B())}}}),j([l,h],()=>{var e;(e=document.querySelector(".slimsearch-result-list-item.active .slimsearch-result-item.active"))==null||e.scrollIntoView(!1)},{flush:"post"}),()=>t("div",{class:["slimsearch-result-wrapper",{empty:a.queries.length?!x.value:!L.value}],id:"slimsearch-results"},a.queries.length?S.value?t(ie,{hint:n.value.searching}):x.value?t("ul",{class:"slimsearch-result-list"},p.value.map(({title:e,contents:s},o)=>{const f=l.value===o;return t("li",{class:["slimsearch-result-list-item",{active:f}]},[t("div",{class:"slimsearch-result-title"},e||n.value.defaultTitle),s.map((c,N)=>{const $=f&&h.value===N;return t(_,{to:F(c),class:["slimsearch-result-item",{active:$,"aria-selected":$}],onClick:()=>{g(a.queries.join(" ")),A(c),B()}},()=>[c.type==="text"?null:t(c.type==="title"?re:c.type==="heading"?ue:ne,{class:"slimsearch-result-type"}),t("div",{class:"slimsearch-result-content"},[c.type==="text"&&c.header?t("div",{class:"content-header"},c.header):null,t("div",K(c))])])})])})):n.value.emptyResult:L.value?[V(),W()]:n.value.emptyHistory)}});export{we as default};
